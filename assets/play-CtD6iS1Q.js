import{r as c,j as e,I as M,R as y,u as S,g as p}from"./index-Ep2W3XrE.js";import{a as r,g as v,b as W,s as I,c as B,e as P,h as R,r as D,C as E}from"./config-manager-CMhBdBPm.js";function L(s){const{children:t,tooltipContent:n,disabled:a,direction:u,id:d,className:h}=s;return c.useEffect(()=>{const m=document.getElementById("tooltip-"+d);m&&!a?setTimeout(()=>{const f=m.getBoundingClientRect().top,l=m.children[1];u===void 0||u==="auto"?f>150?l.classList.add("tooltip-dir-top"):l.classList.add("tooltip-dir-bottom"):l.classList.add("tooltip-dir-"+u)},100):console.warn("Tooltip wrapper not found",d)},[]),e.jsxs("div",{className:"tooltip-wrapper "+(h||""),id:"tooltip-"+d,children:[e.jsx("div",{className:"tooltipped-item",children:t}),!a&&e.jsx("div",{className:"tooltip",children:e.jsx("div",{className:"tooltip-content",children:n})})]})}const F={expand:"drawer-expand",overlay:"drawer-overlay"};function $(s){const{opened:t,direction:n,transition:a,mode:u,className:d,openIcon:h,closeIcon:m,onClick:f,hasButtonLine:l}=s,g=n?`drawer-${n}`:"",[w,x]=c.useState(g),o=F[u];return c.useEffect(()=>{if(!a){x(g+(t?"":"-closed"));return}x(t?g+"-expand":g+"-shrink")},[t]),e.jsxs("div",{className:`drawer drawer-${n} ${w} ${o} ${d||""}`,children:[e.jsxs("div",{className:"drawer-button",onClick:f,children:[e.jsx(M,{icon:t?m:h,className:"drawer-icon"}),l&&e.jsx("div",{className:"drawer-button-line"})]}),e.jsx("div",{className:"drawer-content ",children:y.Children.map(s.children,i=>i)})]})}const A=.5,T=s=>{let t=z(s),n=t[Math.floor(Math.random()*t.length)];for(;s.weapon===n&&Math.random()<A;)n=t[Math.floor(Math.random()*t.length)];return r.setPlayerData(s,"weapon",n),n},z=s=>{let t=r.getWeaponClasses(),n=[];for(let a=0;a<s.allowedWeapons.length;a++)s.allowedWeapons[a]&&n.push(t[a]);return n},O=()=>{let s=r.get("players");for(let t=0;t<r.get("playerCount");t++)T(s[t])};function q(){const s=S(),[t,n]=c.useState(v()),[a,u]=c.useState([]),[d,h]=c.useState([]),[m,f]=c.useState(!1),[l,g]=c.useState([null,null]);c.useEffect(()=>{if(r.get("game")===null){const k=new URL(window.location.href).href.split("=")[1];r.setGame(k)?n(v()):(console.log("no config found"),r.removeSavedConfig(),s("/"))}let o=[],i=[];for(let j of W())j.isDLC?o.push(j):i.push(j);u(i),h(o);let C=I(),b=B(C);g([C,b]),O()},[]);const w=(o,i)=>{r.toggleMonster(o,i),D(),n(v())},x=()=>{f(!m)};return e.jsx(y.Fragment,{children:e.jsxs("div",{className:"content-block page-content play",children:[e.jsx("h1",{className:"page-title",children:p(["ui","title"])}),e.jsxs("div",{className:"task-display",children:[e.jsxs("div",{className:"current-monster",children:[l[0]&&e.jsx(N,{monster:l[0]}),l[1]&&e.jsx(N,{monster:l[1]})]}),e.jsx("div",{className:"player-list",children:r.get("players").map((o,i)=>{if(i<r.get("playerCount"))return e.jsx(G,{player:o},i)})})]}),e.jsxs($,{mode:"overlay",direction:"horizontal",className:"config-drawer",opened:m,transition:!0,openIcon:P,closeIcon:R,hasButtonLine:!0,onClick:x,children:[e.jsx("h2",{className:"config-drawer-title",children:p(["ui","play","config-drawer","title"])}),e.jsxs("div",{className:"monster-selection",children:[e.jsx("h3",{className:"monster-selection-title",children:p(["ui","play","config-drawer","monster-selection","title"])}),e.jsx("p",{className:"monster-selection-description",children:p(["ui","play","config-drawer","monster-selection","description"])}),e.jsx("h4",{className:"monster-selection-subtitle",children:p(["ui","play","config-drawer","monster-selection","base-monsters"])}),e.jsx("div",{className:"monster-grid",children:a.map(o=>e.jsx(N,{monster:o,toggleMonster:w,hasCheckBox:!0},o.id))}),r.get("dlc")&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"monster-selection-subtitle",children:p(["ui","play","config-drawer","monster-selection","dlc-monsters"])}),e.jsx("div",{className:"monster-grid",children:d.map(o=>e.jsx(N,{monster:o,toggleMonster:w,hasCheckBox:!0},o.id))})]})]})]})]})})}const N=({monster:s,toggleMonster:t,hasCheckBox:n})=>e.jsxs(L,{id:s.id,className:"monster-card",tooltipContent:p(["ui","monsters",r.get("game"),s.key]),disabled:!1,direction:"auto",children:[e.jsx(M,{icon:"."+s.key,className:"monster-icon"}),n&&e.jsx(E,{checked:r.isMonsterAllowed(s.id),onChange:a=>t(s.id,a),className:"monster-checkbox",dir:"rtl"})]},s.id),G=({player:s})=>e.jsxs("div",{className:"player-card",children:[e.jsx("div",{className:"player-weapon",children:s.weapon!==void 0&&s.weapon!==-1&&e.jsx(L,{id:s.name+s.weapon,className:"weapon-tooltip",tooltipContent:p(["ui","game-config","weapon-classes",s.weapon]),disabled:!1,direction:"auto",children:e.jsx(M,{icon:"."+s.weapon,className:"weapon-icon"})})}),e.jsx("p",{className:"player-name",children:s.name})]});export{q as default};
