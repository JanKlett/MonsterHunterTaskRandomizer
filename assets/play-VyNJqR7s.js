import{r as c,j as e,I as b,R as S,u as $,g as n}from"./index-CY9u5nsO.js";import{a as o,g as M,b as A,B as f,c as B,e as E,h as z,i as O,r as T,s as U,j as G,T as I,C as q,k as H}from"./config-manager-CRYb4J6I.js";const J={expand:"drawer-expand",overlay:"drawer-overlay"};function K(s){const{opened:t,direction:l,transition:r,mode:g,className:m,openIcon:N,closeIcon:x,onClick:v,hasButtonLine:p}=s,u=l?`drawer-${l}`:"",[h,d]=c.useState(u),y=J[g];return c.useEffect(()=>{if(!r){d(u+(t?"":"-closed"));return}d(t?u+"-expand":u+"-shrink")},[t]),e.jsxs("div",{className:`drawer drawer-${l} ${h} ${y} ${m||""}`,children:[e.jsxs("div",{className:"drawer-button",onClick:v,children:[e.jsx(b,{icon:t?x:N,className:"drawer-icon"}),p&&e.jsx("div",{className:"drawer-button-line"})]}),e.jsx("div",{className:"drawer-content ",children:S.Children.map(s.children,C=>C)})]})}const Q=.5,k=s=>{let t=V(s),l=t[Math.floor(Math.random()*t.length)];for(;s.weapon===l&&Math.random()<Q;)l=t[Math.floor(Math.random()*t.length)];return o.setPlayerData(s,"weapon",l),l},V=s=>{let t=o.getWeaponClasses(),l=[];for(let r=0;r<s.allowedWeapons.length;r++)s.allowedWeapons[r]&&l.push(t[r]);return l},X=()=>{let s=o.get("players");for(let t=0;t<o.get("playerCount");t++)k(s[t])};function ee(){const s=$(),[t,l]=c.useState(M()),[r,g]=c.useState([]),[m,N]=c.useState([]),[x,v]=c.useState(!1),[p,u]=c.useState([null,null]),[h,d]=c.useState(!1);c.useEffect(()=>{if(o.get("game")===null){const F=new URL(window.location.href).href.split("=")[1];o.setGame(F)?l(M()):(console.log("no config found"),o.removeSavedConfig(),s("/"))}let a=[],i=[];for(let j of A())j.isDLC?a.push(j):i.push(j);g(i),N(a),P()},[]);const y=(a,i)=>{o.toggleMonster(a,i),T(),l(M())},C=()=>{v(!x)},R=()=>{o.addPlayer(),k(o.get("players")[o.get("playerCount")-1]),d(!h)},W=a=>{o.removePlayer(a),d(!h)},D=a=>{k(a),d(!h)},L=()=>{let a=U(),i=G(a);u([a,i])},P=()=>{L(),X(),d(!h)};return e.jsx(S.Fragment,{children:e.jsxs("div",{className:"content-block page-content play",children:[e.jsx("h1",{className:"page-title",children:n(["ui","title"])}),e.jsxs("div",{className:"task-display",children:[e.jsx("h2",{className:"task-display-title",children:n(["ui","play","task-display","title"])}),e.jsxs("div",{className:"current-monster",children:[p[0]&&e.jsx(w,{monster:p[0]}),p[1]&&e.jsx(w,{monster:p[1]}),e.jsx(f,{className:"monster-reroll-button",disabled:!1,icon:B,tooltip:n(["ui","play","task-display","reroll-monster"]),id:"reroll-monster",onClick:L})]}),e.jsx("div",{className:"player-list",children:o.get("players").map((a,i)=>{if(i<o.get("playerCount"))return e.jsx(Y,{player:a,idx:i,onRemovePlayer:W,onRerollPlayer:D},i);if(i===o.get("playerCount"))return e.jsx("div",{className:"player-card player-button",children:e.jsx(f,{className:"add-player-button",disabled:!1,icon:E,title:n(["ui","play","task-display","add-player"]),onClick:R})},i)})}),e.jsx(f,{className:"reroll-all-button",disabled:!1,title:n(["ui","play","task-display","reroll-all"]),id:"reroll-all",onClick:P})]}),e.jsxs(K,{mode:"overlay",direction:"horizontal",className:"config-drawer",opened:x,transition:!0,openIcon:z,closeIcon:O,hasButtonLine:!0,onClick:C,children:[e.jsx("h2",{className:"config-drawer-title",children:n(["ui","play","config-drawer","title"])}),e.jsxs("div",{className:"monster-selection",children:[e.jsx("h3",{className:"monster-selection-title",children:n(["ui","play","config-drawer","monster-selection","title"])}),e.jsx("p",{className:"monster-selection-description",children:n(["ui","play","config-drawer","monster-selection","description"])}),e.jsx("h4",{className:"monster-selection-subtitle",children:n(["ui","play","config-drawer","monster-selection","base-monsters"])}),e.jsx("div",{className:"monster-grid",children:r.map(a=>e.jsx(w,{monster:a,toggleMonster:y,hasCheckBox:!0},a.id))}),o.get("dlc")&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"monster-selection-subtitle",children:n(["ui","play","config-drawer","monster-selection","dlc-monsters"])}),e.jsx("div",{className:"monster-grid",children:m.map(a=>e.jsx(w,{monster:a,toggleMonster:y,hasCheckBox:!0},a.id))})]})]})]})]})})}const w=({monster:s,toggleMonster:t,hasCheckBox:l})=>e.jsxs(I,{id:s.id,className:"monster-card",tooltipContent:n(["ui","monsters",o.get("game"),s.key]),disabled:!1,direction:"auto",children:[e.jsx(b,{icon:"."+s.key,className:"monster-icon"}),l&&e.jsx(q,{checked:o.isMonsterAllowed(s.id),onChange:r=>t(s.id,r),className:"monster-checkbox",dir:"rtl"})]},s.id),Y=({player:s,idx:t,onRerollPlayer:l,onRemovePlayer:r})=>{const g=()=>{l(s)},m=()=>{r(t)};return e.jsxs("div",{className:"player-card",children:[e.jsx("div",{className:"player-weapon",children:s.weapon!==void 0&&s.weapon!==-1&&e.jsx(I,{id:s.name+s.weapon,className:"weapon-tooltip",tooltipContent:n(["ui","game-config","weapon-classes",s.weapon]),disabled:!1,direction:"auto",children:e.jsx(b,{icon:"."+s.weapon,className:"weapon-icon"})})}),e.jsx("p",{className:"player-name",children:s.name}),e.jsx("div",{className:"player-challenges"}),e.jsxs("div",{className:"player-controls",children:[e.jsx(f,{id:s.name+"-remove",className:"player-controll-button",disabled:!1,icon:H,tooltip:n(["ui","play","task-display","remove-player"]),tooltipDir:"top",onClick:m}),e.jsx(f,{id:s.name+"-reroll",className:"player-controll-button",disabled:!1,icon:B,tooltip:n(["ui","play","task-display","reroll-player"]),tooltipDir:"bottom",onClick:g})]})]})};export{ee as default};
