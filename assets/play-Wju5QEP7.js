import{r as f,j as l,I as L,R,g as h,u as U}from"./index-C-c5WbMp.js";import{T as v,a as o,C as F,b as z,c as G,B as k,e as X,g as V,h as q,m as H,i as J,w as K,r as Q,s as Y,j as Z}from"./config-manager-DXdNOyja.js";const _={expand:"drawer-expand",overlay:"drawer-overlay"};function ee(e){const{opened:t,direction:s,transition:a,mode:c,className:n,openIcon:u,closeIcon:m,onClick:d,hasButtonLine:i}=e,r=s?`drawer-${s}`:"",[p,x]=f.useState(r),w=_[c];return f.useEffect(()=>{if(!a){x(r+(t?"":"-closed"));return}x(t?r+"-expand":r+"-shrink")},[t]),l.jsxs("div",{className:`drawer drawer-${s} ${p} ${w} ${n||""}`,children:[l.jsxs("div",{className:"drawer-button",onClick:d,children:[l.jsx(L,{icon:t?m:u,className:"drawer-icon"}),i&&l.jsx("div",{className:"drawer-button-line"})]}),l.jsx("div",{className:"drawer-content ",children:R.Children.map(e.children,j=>j)})]})}function E(e){const{icon:t,title:s,onValueChanged:a,defaultValue:c,min:n,max:u,disabled:m,className:d,tooltip:i,tooltipDir:r,id:p,hasTooltip:x,unit:w}=e,[j,P]=f.useState(c),y=(p||"").replace(" ","-"),g=M=>{let D=document.getElementById(y+"-slider").getBoundingClientRect(),$=D.left,A=D.width,O=M.clientX,b=Math.floor((O-$)/A*100);b<0?b=0:b>100&&(b=100),P(b),a(b)},C=M=>{document.getElementById(y+"-slider-wrapper").onmousemove=g},N=M=>{document.getElementById(y+"-slider-wrapper").onmousemove=null};return f.useEffect(()=>{P(c)},[c]),l.jsx(v,{tooltipContent:i,direction:r,disabled:!x,id:y,className:"slider-box-tooltip",children:l.jsxs("div",{className:"slider-box"+(m?" disabled ":" ")+(d??d),id:y,children:[l.jsxs("div",{className:"slider-box-title",children:[l.jsx(L,{icon:t,className:"slider-box-title-icon"}),l.jsx("span",{className:"slider-box-title-txt",children:s})]}),l.jsx(v,{tooltipContent:j+(w||""),direction:"top",id:y+"-tooltip",className:"slider-tooltip",style:{left:`${j}%`},children:l.jsxs("div",{className:"slider-wrapper",id:y+"-slider-wrapper",children:[l.jsx("input",{type:"range",min:n,max:u,value:j,className:"slider-input",disabled:m,readOnly:!0}),l.jsxs("div",{className:"slider-bar",id:y+"-slider",children:[l.jsx("div",{className:"slider-fill",style:{width:`${j}%`}}),l.jsx("div",{className:"slider-thumb",style:{left:`${j}%`},onMouseDown:C,onMouseUp:N})]})]})})]})})}function I({monster:e,toggleMonster:t,hasCheckBox:s}){return l.jsxs(v,{id:e.id,className:"monster-card",tooltipContent:h(["ui","monsters",o.get("game"),e.key]),disabled:!1,direction:"auto",children:[l.jsx(L,{icon:"."+e.key,className:"monster-icon"}),s&&l.jsx(F,{checked:o.isMonsterAllowed(e.id),onChange:a=>t(e.id,a),className:"monster-checkbox",dir:"rtl"})]},e.id)}function le({baseMonsterList:e,dlcMonsterList:t,toggleMonster:s,doubelMonsterChance:a,changeDoubleMonsterChance:c,isDLC:n}){return l.jsxs("div",{className:"monster-config",children:[l.jsx("h3",{className:"monster-config-title",children:h(["ui","play","config-drawer","monster-config","title"])}),l.jsx("div",{className:"monster-config-double-chance-control",children:l.jsx(E,{className:"double-monster-chance-slider",id:"double-monster-chance-slider",title:h(["ui","play","config-drawer","monster-config","double-monster-chance"]),onValueChanged:c,defaultValue:a*100,disabled:!1,min:0,max:100,unit:"%"})}),l.jsx("p",{className:"monster-config-selection-description",children:h(["ui","play","config-drawer","monster-config","description"])}),l.jsx("h4",{className:"monster-config-selection-title",children:h(["ui","play","config-drawer","monster-config","base-monsters"])}),l.jsx("div",{className:"monster-config-grid",children:e.map(u=>l.jsx(I,{monster:u,toggleMonster:s,hasCheckBox:!0},u.id))}),n&&l.jsxs(l.Fragment,{children:[l.jsx("h4",{className:"monster-config-selection-title",children:h(["ui","play","config-drawer","monster-config","dlc-monsters"])}),l.jsx("div",{className:"monster-config-grid",children:t.map(u=>l.jsx(I,{monster:u,toggleMonster:s,hasCheckBox:!0},u.id))})]})]})}function se({label:e,value:t,placeholder:s,disabled:a,readOnly:c,required:n,type:u,name:m,className:d,onChange:i}){const[r,p]=f.useState(t),x=w=>{p(w.target.value),i&&i(w.target.value,r)};return f.useEffect(()=>{p(t)},[t]),l.jsxs("div",{className:"text-input-container input "+(d||""),children:[l.jsx("label",{className:"text-input-label",htmlFor:m,children:e}),l.jsx("input",{className:"text-input",type:u,name:m,value:r,placeholder:s,disabled:a,readOnly:c,required:n,onChange:x})]})}function te({player:e,onPlayerChange:t,weaponList:s,idx:a}){const[c,n]=f.useState(e.name),u=(i,r)=>{e[r]=i,t(e)},m=(i,r)=>{e.allowedWeapons[r]=i,t(e)},d=i=>!(e.allowedWeapons.filter(p=>p).length>1)&&e.allowedWeapons[i];return f.useEffect(()=>{n(e.name)},[e.name]),l.jsxs("div",{className:"player-config-player",children:[l.jsx(se,{className:"player-config-name",label:h(["ui","play","config-drawer","player-config","player-name"]),value:c,onChange:i=>{u(i,"name")}}),l.jsxs("div",{className:"player-config-allowed-weapons",children:[l.jsx("h4",{className:"player-config-allowed-weapons-title",children:h(["ui","play","config-drawer","player-config","allowed-weapons"])}),l.jsx("div",{className:"player-config-allowed-weapons-list",children:s.map((i,r)=>l.jsxs(v,{id:i+a,className:"weapon-card",tooltipContent:h(["ui","game-config","weapon-classes",i]),disabled:!1,direction:"top",children:[l.jsx(L,{icon:"."+i,className:"weapon-icon"}),l.jsx(F,{checked:e.allowedWeapons[r],onChange:p=>m(p,r),className:"weapon-checkbox",disabled:d(r),dir:"rtl"})]},i+a))})]}),l.jsx("div",{className:"player-config-double-challenge",children:l.jsx(E,{className:"double-challenge-slider",id:"double-challenge-slider"+a,title:h(["ui","play","config-drawer","player-config","double-challenge-chance"]),onValueChanged:i=>u(i/100,"doubleChallengeChance"),defaultValue:e.doubleChallengeChance*100,disabled:!1,unit:"%",min:0,max:100})})]})}function ae({players:e,playerCount:t,onPlayerChange:s,weaponList:a}){return l.jsxs("div",{className:"player-config",children:[l.jsx("h3",{className:"player-config-title",children:h(["ui","play","config-drawer","player-config","title"])}),e.map((c,n)=>n>=t?null:l.jsx(te,{idx:n,player:c,onPlayerChange:s,weaponList:a},n))]})}function ne({baseMonsterList:e,dlcMonsterList:t,toggleMonster:s,doubelMonsterChance:a,changeDoubleMonsterChance:c,players:n,playerCount:u,onPlayerChange:m,weaponList:d,isDLC:i}){const[r,p]=f.useState(!1),x=()=>{p(!r)};return l.jsxs(ee,{mode:"overlay",direction:"horizontal",className:"config-drawer",opened:r,transition:!0,openIcon:z,closeIcon:G,hasButtonLine:!0,onClick:x,children:[l.jsx("h2",{className:"config-drawer-title",children:h(["ui","play","config-drawer","title"])}),l.jsx(ae,{players:n,playerCount:u,onPlayerChange:m,weaponList:d}),l.jsx(le,{baseMonsterList:e,dlcMonsterList:t,toggleMonster:s,doubelMonsterChance:a,changeDoubleMonsterChance:c,isDLC:i})]})}function oe({player:e,idx:t,onRerollPlayer:s,onRemovePlayer:a,playerCount:c,gameKey:n}){const u=()=>{s(e)},m=()=>{a(t)};return l.jsxs("div",{className:"player-card",children:[l.jsx("div",{className:"player-weapon",children:e.weapon!==void 0&&e.weapon!==-1&&l.jsx(v,{id:e.name+e.weapon,className:"weapon-tooltip",tooltipContent:h(["ui","game-config","weapon-classes",e.weapon]),disabled:!1,direction:"auto",children:l.jsx(L,{icon:"."+e.weapon,className:"weapon-icon"})})}),l.jsx("p",{className:"player-name",children:e.name}),l.jsx("div",{className:"player-challenges",children:e.challenges.map((d,i)=>l.jsx(v,{id:e.name+d.id,className:"challenge-tooltip",tooltipContent:h(["ui","challenges",n,d.key,"description"]),disabled:!1,direction:"auto",children:h(["ui","challenges",n,d.key,"title"])},i))}),l.jsxs("div",{className:"player-controls",children:[l.jsx(k,{id:e.name+"-remove",className:"player-controll-button",disabled:c<=1,icon:X,tooltip:h(["ui","play","task-display","remove-player"]),tooltipDir:"top",onClick:m}),l.jsx(k,{id:e.name+"-reroll",className:"player-controll-button",disabled:!1,icon:V,tooltip:h(["ui","play","task-display","reroll-player"]),tooltipDir:"bottom",onClick:u})]})]})}function ie({currentMonsters:e,players:t,playerCount:s,rerollMonsters:a,removePlayer:c,rerollPlayer:n,addPlayer:u,rerollAll:m,gameKey:d}){return l.jsxs("div",{className:"task-display",children:[l.jsx("h2",{className:"task-display-title",children:h(["ui","play","task-display","title"])}),l.jsxs("div",{className:"current-monster",children:[e[0]&&l.jsx(I,{monster:e[0]}),e[1]&&l.jsx(I,{monster:e[1]}),l.jsx(k,{className:"monster-reroll-button",disabled:!1,icon:V,tooltip:h(["ui","play","task-display","reroll-monster"]),id:"reroll-monster",onClick:a})]}),l.jsx("div",{className:"player-list",children:t.map((i,r)=>{if(r<s)return l.jsx(oe,{player:i,idx:r,onRemovePlayer:c,onRerollPlayer:n,playerCount:s,gameKey:d},r);if(r===s)return l.jsx("div",{className:"player-card player-button",children:l.jsx(k,{className:"add-player-button",disabled:!1,icon:q,title:h(["ui","play","task-display","add-player"]),onClick:u})},r)})}),l.jsx(k,{className:"reroll-all-button",disabled:!1,title:h(["ui","play","task-display","reroll-all"]),id:"reroll-all",onClick:m})]})}const S=e=>{let t=re(e),s=t[Math.floor(Math.random()*t.length)];for(;e.weapon===s&&Math.random()<o.get("rerollSameWeaponChance");)s=t[Math.floor(Math.random()*t.length)];return o.setPlayerData(e,"weapon",s),s},re=e=>{let t=o.getWeaponClasses(),s=[];for(let a=0;a<e.allowedWeapons.length;a++)e.allowedWeapons[a]&&s.push(t[a]);return s},ce=()=>{let e=o.get("players");for(let t=0;t<o.get("playerCount");t++)S(e[t])};var W=[];const de=()=>(W.length===0&&ue(),W),ue=()=>{W=structuredClone(me()),he()},me=()=>o.get("game")==="mhworld"?(o.get("challenges").length===0&&o.set("challenges",H),o.get("challenges")):[],he=()=>{W=o.get("challenges").filter(e=>e.isActive)},B=(e,t)=>{let s=de(),a=0;for(let n=0;n<e.length;n++)e[n]===void 0||e[n]===null||(a+=e[n].threatLevel);let c=s[Math.floor(Math.random()*s.length)];for(;!T(c,a,t);)c=s[Math.floor(Math.random()*s.length)];if(Math.random()<t.doubleChallengeChance){let n=s[Math.floor(Math.random()*s.length)];for(;!ge(c,n,a,t);)n=s[Math.floor(Math.random()*s.length)];t.challenges=[c,n]}else t.challenges=[c]},T=(e,t,s)=>{if(e==null||!e.isActive)return!1;let a=s.weapon;return!(e.excludedWeapons.includes(a)||e.maxThreatLevel<=t||e===s.challenges[0]||s.challenges.length>1&&s.challenges[1]!==null&&e===s.challenges[1])},ge=(e,t,s,a)=>!(!T(t,s,a)||e.id===t.id||t.key==="two-challenges"||e.excludedChallenges.includes(t.id)||t.excludedChallenges.includes(e.id)),pe=e=>{let t=o.get("players");for(let s=0;s<o.get("playerCount");s++)B(e,t[s])};function je(){const e=U(),[t,s]=f.useState([]),[a,c]=f.useState([]),[n,u]=f.useState([null,null]),[m,d]=f.useState(!1);f.useEffect(()=>{if(o.get("game")===null){const M=new URL(window.location.href).href.split("=")[1];if(!o.setGame(M)){console.log("no config found"),o.removeSavedConfig(),o.reset(),e("/");return}}d(!m);let g=[],C=[];for(let N of J())N.isDLC?g.push(N):C.push(N);s(C),c(g),j()},[]);const i=(g,C)=>{o.toggleMonster(g,C),Q()},r=()=>{o.addPlayer(),S(o.get("players")[o.get("playerCount")-1]),B(n,o.get("players")[o.get("playerCount")-1]),d(!m)},p=g=>{o.removePlayerByIdx(g),d(!m)},x=g=>{S(g),B(n,g),d(!m)},w=()=>{let g=Y(),C=Z(g);return u([g,C]),[g,C]},j=()=>{let g=w();ce(),pe(g),d(!m)},P=g=>{o.set("doubleMonsterChance",g/100)},y=g=>{o.save(),d(!m)};return l.jsx(R.Fragment,{children:l.jsxs("div",{className:"content-block page-content play",children:[l.jsx("h1",{className:"page-title",children:h(["ui","title"])}),l.jsx(ie,{addPlayer:r,removePlayer:p,rerollPlayer:x,rerollMonsters:w,rerollAll:j,players:o.get("players"),playerCount:o.get("playerCount"),currentMonsters:n,gameKey:o.get("game")}),l.jsx(ne,{baseMonsterList:t,dlcMonsterList:a,toggleMonster:i,changeDoubleMonsterChance:P,doubelMonsterChance:o.get("doubleMonsterChance"),players:o.get("players"),playerCount:o.get("playerCount"),onPlayerChange:y,weaponList:K,isDLC:o.get("dlc")})]})})}export{je as default};
