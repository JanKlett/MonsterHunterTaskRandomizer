import{r as h,j as s,I as P,R as W,u as A,g as i}from"./index-CHHRmowg.js";import{a,m as T,g as $,B as x,b as B,c as E,e as z,h as O,r as U,i as V,s as G,j as q,T as k,C as H,k as J}from"./config-manager-BOhSNp_U.js";const K={expand:"drawer-expand",overlay:"drawer-overlay"};function Q(e){const{opened:l,direction:t,transition:o,mode:d,className:r,openIcon:g,closeIcon:u,onClick:N,hasButtonLine:p}=e,m=t?`drawer-${t}`:"",[y,f]=h.useState(m),v=K[d];return h.useEffect(()=>{if(!o){f(m+(l?"":"-closed"));return}f(l?m+"-expand":m+"-shrink")},[l]),s.jsxs("div",{className:`drawer drawer-${t} ${y} ${v} ${r||""}`,children:[s.jsxs("div",{className:"drawer-button",onClick:N,children:[s.jsx(P,{icon:l?u:g,className:"drawer-icon"}),p&&s.jsx("div",{className:"drawer-button-line"})]}),s.jsx("div",{className:"drawer-content ",children:W.Children.map(e.children,M=>M)})]})}const b=e=>{let l=X(e),t=l[Math.floor(Math.random()*l.length)];for(;e.weapon===t&&Math.random()<a.get("rerollSameWeaponChance");)t=l[Math.floor(Math.random()*l.length)];return a.setPlayerData(e,"weapon",t),t},X=e=>{let l=a.getWeaponClasses(),t=[];for(let o=0;o<e.allowedWeapons.length;o++)e.allowedWeapons[o]&&t.push(l[o]);return t},Y=()=>{let e=a.get("players");for(let l=0;l<a.get("playerCount");l++)b(e[l])};var C=[];const Z=()=>(C.length===0&&_(),C),_=()=>{C=structuredClone(ee()),se()},ee=()=>a.get("game")==="mhworld"?(a.get("challenges").length===0&&a.set("challenges",T),a.get("challenges")):[],se=()=>{C=a.get("challenges").filter(e=>e.isActive)},L=(e,l)=>{let t=Z(),o=0;for(let r=0;r<e.length;r++)e[r]===void 0||e[r]===null||(o+=e[r].threatLevel);let d=t[Math.floor(Math.random()*t.length)];for(;!D(d,o,l);)d=t[Math.floor(Math.random()*t.length)];if(Math.random()<a.get("doubleChallengeChance")){let r=t[Math.floor(Math.random()*t.length)];for(;!te(d,r,o,l);)r=t[Math.floor(Math.random()*t.length)];l.challenges=[d,r]}else l.challenges=[d]},D=(e,l,t)=>{if(e==null||!e.isActive)return!1;let o=t.weapon;return!(e.excludedWeapons.includes(o)||e.maxThreatLevel<=l||e===t.challenges[0]||t.challenges.length>1&&t.challenges[1]!==null&&e===t.challenges[1])},te=(e,l,t,o)=>!(!D(l,t,o)||e.id===l.id||l.key==="two-challenges"||e.excludedChallenges.includes(l.id)||l.excludedChallenges.includes(e.id)),le=e=>{let l=a.get("players");for(let t=0;t<a.get("playerCount");t++)L(e,l[t])};function re(){const e=A(),[l,t]=h.useState([]),[o,d]=h.useState([]),[r,g]=h.useState(!1),[u,N]=h.useState([null,null]),[p,m]=h.useState(!1);h.useEffect(()=>{if(a.get("game")===null){const R=new URL(window.location.href).href.split("=")[1];a.setGame(R)||(console.log("no config found"),a.removeSavedConfig(),e("/"))}let n=[],c=[];for(let w of $())w.isDLC?n.push(w):c.push(w);t(c),d(n),I()},[]);const y=(n,c)=>{a.toggleMonster(n,c),U(),setMonsterList(V())},f=()=>{g(!r)},v=()=>{a.addPlayer(),b(a.get("players")[a.get("playerCount")-1]),L(u,a.get("players")[a.get("playerCount")-1]),m(!p)},M=n=>{a.removePlayerByIdx(n),m(!p)},F=n=>{b(n),L(u,n),m(!p)},S=()=>{let n=G(),c=q(n);return N([n,c]),[n,c]},I=()=>{let n=S();Y(),le(n),m(!p)};return s.jsx(W.Fragment,{children:s.jsxs("div",{className:"content-block page-content play",children:[s.jsx("h1",{className:"page-title",children:i(["ui","title"])}),s.jsxs("div",{className:"task-display",children:[s.jsx("h2",{className:"task-display-title",children:i(["ui","play","task-display","title"])}),s.jsxs("div",{className:"current-monster",children:[u[0]&&s.jsx(j,{monster:u[0]}),u[1]&&s.jsx(j,{monster:u[1]}),s.jsx(x,{className:"monster-reroll-button",disabled:!1,icon:B,tooltip:i(["ui","play","task-display","reroll-monster"]),id:"reroll-monster",onClick:S})]}),s.jsx("div",{className:"player-list",children:a.get("players").map((n,c)=>{if(c<a.get("playerCount"))return s.jsx(ae,{player:n,idx:c,onRemovePlayer:M,onRerollPlayer:F},c);if(c===a.get("playerCount"))return s.jsx("div",{className:"player-card player-button",children:s.jsx(x,{className:"add-player-button",disabled:!1,icon:E,title:i(["ui","play","task-display","add-player"]),onClick:v})},c)})}),s.jsx(x,{className:"reroll-all-button",disabled:!1,title:i(["ui","play","task-display","reroll-all"]),id:"reroll-all",onClick:I})]}),s.jsxs(Q,{mode:"overlay",direction:"horizontal",className:"config-drawer",opened:r,transition:!0,openIcon:z,closeIcon:O,hasButtonLine:!0,onClick:f,children:[s.jsx("h2",{className:"config-drawer-title",children:i(["ui","play","config-drawer","title"])}),s.jsxs("div",{className:"monster-selection",children:[s.jsx("h3",{className:"monster-selection-title",children:i(["ui","play","config-drawer","monster-selection","title"])}),s.jsx("p",{className:"monster-selection-description",children:i(["ui","play","config-drawer","monster-selection","description"])}),s.jsx("div",{className:"monster-selection-double-chance-control"}),s.jsx("h4",{className:"monster-selection-subtitle",children:i(["ui","play","config-drawer","monster-selection","base-monsters"])}),s.jsx("div",{className:"monster-grid",children:l.map(n=>s.jsx(j,{monster:n,toggleMonster:y,hasCheckBox:!0},n.id))}),a.get("dlc")&&s.jsxs(s.Fragment,{children:[s.jsx("h4",{className:"monster-selection-subtitle",children:i(["ui","play","config-drawer","monster-selection","dlc-monsters"])}),s.jsx("div",{className:"monster-grid",children:o.map(n=>s.jsx(j,{monster:n,toggleMonster:y,hasCheckBox:!0},n.id))})]})]})]})]})})}const j=({monster:e,toggleMonster:l,hasCheckBox:t})=>s.jsxs(k,{id:e.id,className:"monster-card",tooltipContent:i(["ui","monsters",a.get("game"),e.key]),disabled:!1,direction:"auto",children:[s.jsx(P,{icon:"."+e.key,className:"monster-icon"}),t&&s.jsx(H,{checked:a.isMonsterAllowed(e.id),onChange:o=>l(e.id,o),className:"monster-checkbox",dir:"rtl"})]},e.id),ae=({player:e,idx:l,onRerollPlayer:t,onRemovePlayer:o})=>{const d=()=>{t(e)},r=()=>{o(l)};return s.jsxs("div",{className:"player-card",children:[s.jsx("div",{className:"player-weapon",children:e.weapon!==void 0&&e.weapon!==-1&&s.jsx(k,{id:e.name+e.weapon,className:"weapon-tooltip",tooltipContent:i(["ui","game-config","weapon-classes",e.weapon]),disabled:!1,direction:"auto",children:s.jsx(P,{icon:"."+e.weapon,className:"weapon-icon"})})}),s.jsx("p",{className:"player-name",children:e.name}),s.jsx("div",{className:"player-challenges",children:e.challenges.map((g,u)=>s.jsx(k,{id:e.name+g.id,className:"challenge-tooltip",tooltipContent:i(["ui","challenges",a.get("game"),g.key,"description"]),disabled:!1,direction:"auto",children:i(["ui","challenges",a.get("game"),g.key,"title"])},u))}),s.jsxs("div",{className:"player-controls",children:[s.jsx(x,{id:e.name+"-remove",className:"player-controll-button",disabled:a.get("playerCount")<=1,icon:J,tooltip:i(["ui","play","task-display","remove-player"]),tooltipDir:"top",onClick:r}),s.jsx(x,{id:e.name+"-reroll",className:"player-controll-button",disabled:!1,icon:B,tooltip:i(["ui","play","task-display","reroll-player"]),tooltipDir:"bottom",onClick:d})]})]})};export{re as default};
